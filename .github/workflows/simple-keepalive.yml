name: Simple Supabase Keepalive

on:
  schedule:
    # Run every 10 minutes
    - cron: '*/10 * * * *'
  workflow_dispatch:

jobs:
  keepalive:
    runs-on: ubuntu-latest
    
    steps:
    - name: Multi-Target Keepalive
      run: |
        echo "ðŸš€ Starting keepalive sequence at $(date -u)"
        
        # 1. Ping your main site to wake up the frontend
        echo "ðŸ“± Pinging main site..."
        SITE_STATUS=$(curl -s -o /dev/null -w "%{http_code}" \
          "https://delicate-duckanoo-0af0ad.netlify.app" || echo "000")
        echo "Site status: $SITE_STATUS"
        
        # 2. Try to access the site with specific paths that might trigger database calls
        echo "ðŸ”„ Triggering potential database activity..."
        
        # Ping the root page (might trigger initial data load)
        curl -s "https://delicate-duckanoo-0af0ad.netlify.app/" > /dev/null
        
        # Try to access potential API routes or trigger client-side database calls
        curl -s "https://delicate-duckanoo-0af0ad.netlify.app/static/js/main.55f3dac7.js" > /dev/null
        
        # 3. Multiple pings to ensure consistent activity
        for i in {1..3}; do
          echo "Ping attempt $i/3"
          curl -s "https://delicate-duckanoo-0af0ad.netlify.app/?keepalive=$i" > /dev/null
          sleep 2
        done
        
        echo "âœ… Keepalive sequence completed"
        echo "ðŸ”„ Next run scheduled in 10 minutes"

    - name: Status Report
      run: |
        echo "ðŸ“Š Keepalive Summary:"
        echo "Time: $(date -u)"
        echo "Target: delicate-duckanoo-0af0ad.netlify.app"
        echo "Strategy: Multi-ping approach to maintain site activity"
        echo "Frequency: Every 10 minutes"